{"version":3,"sources":["webpack:///./src/demo/tilemap.js"],"names":["mountPoint","document","getElementById","canvas","createElement","classList","add","appendChild","app","el","debug","clearColor","resolution","width","height","load","basePath","programs","tilemapTex","tileWidth","tileHeight","layers","run","loader","loading","addTiles","framebufferRenderer","game","textureInfo","texture","framebuffer","renderer","textureArray","tilemap","getTile","x","y","w","h","grid","requestAnimationFrame","render","adjustViewport","clear","attach","draw","detach","position","size"],"mappings":";;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AAEA;;;;;;AAGA,MAAMA,aAAaC,SAASC,cAAT,CAAwB,SAAxB,CAAnB;AACA,MAAMC,SAASF,SAASG,aAAT,CAAuB,QAAvB,CAAf;AACAD,OAAOE,SAAP,CAAiBC,GAAjB,CAAqB,MAArB;AACAN,WAAWO,WAAX,CAAuBJ,MAAvB;;AAGA,MAAMK,MAAM,kBAAQ;AAChBC,QAAIN,MADY;AAEhBO,WAAO,KAFS;AAGhBC,gBAAY,CAAC,GAAD,EAAM,GAAN,EAAW,GAAX,EAAgB,CAAhB,CAHI;AAIhBC,gBAAY;AACRC,eAAO,GADC;AAERC,gBAAQ;AAFA;AAJI,CAAR,CAAZ;;AAWAN,IAAIO,IAAJ,CAAS;AACLC,cAAU,UADL;AAELC,cAAU,CAAC,MAAD,EAAS,SAAT,EAAoB,QAApB;AAFL,CAAT;;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA,MAAMC,aAAa,oCAA0B;AACzCC,eAAW,EAD8B;AAEzCC,gBAAY,EAF6B;AAGzCP,WAAO,EAHkC;AAIzCC,YAAQ,EAJiC;AAKzCO,YAAQ;AALiC,CAA1B,CAAnB;;AAQA,eAAeC,GAAf,GAAqB;AACjB,UAAMd,IAAIe,MAAJ,CAAWC,OAAjB;;AAEAN,eAAWO,QAAX,EAAoB,MAAM,qBAAU,eAAV,CAA1B;;AAEA,UAAMC,sBAAsB,6BAAmB;AAC3CC,cAAMnB,GADqC;AAE3CoB;AACIC,qBAASrB,IAAIsB,WAAJ,CAAgBD;AAD7B,WAEOrB,IAAII,UAFX;AAF2C,KAAnB,CAA5B;;AAQA,UAAMmB,WAAW,8BAAoB;AACjCJ,cAAMnB,GAD2B;AAEjCwB,sBAAcd,WAAWW,OAFQ;AAGjCI,iBAAS;AACLd,uBAAW,EADN;AAELC,wBAAY,EAFP;AAGLP,mBAAO,EAHF;AAILC,oBAAQ,EAJH;AAKLoB,oBAAQC,CAAR,EAAWC,CAAX,EAAc;AACV,sBAAMC,IAAI,EAAV;AACA,sBAAMC,IAAI,EAAV;;AAEAH,oBAAIA,IAAIE,CAAR;AACAD,oBAAIA,IAAIE,CAAR;;AAEA,uBAAOH,IAAI,CAACG,IAAIF,CAAJ,GAAQ,CAAT,IAAcC,CAAzB;AACH;AAbI;AAHwB,KAApB,CAAjB;;AAoBA,UAAME,OAAO,0BAAgB/B,GAAhB,CAAb;AACA;AACA;AACA;;;AAGAgC,0BAAsB,SAASC,MAAT,GAAkB;AACpCjC,YAAIkC,cAAJ;AACAlC,YAAImC,KAAJ;;AAEAnC,YAAIsB,WAAJ,CAAgBc,MAAhB;AACApC,YAAImC,KAAJ;;AAEAZ,iBAASc,IAAT,CAAc;AACVV,eAAG,CADO;AAEVC,eAAG,GAFO;AAGVvB,mBAAO,GAHG;AAIVC,oBAAQ;AAJE,SAAd;;AAOAyB,aAAKE,MAAL;;AAEAjC,YAAIsB,WAAJ,CAAgBgB,MAAhB;AACAtC,YAAIkC,cAAJ;;AAEAhB,4BAAoBe,MAApB,CAA2B,CACvB,uBAAW;AACPM,sBAAU,CAAC,CAAD,EAAI,CAAJ,CADH;AAEPC,kBAAM,CAACxC,IAAII,UAAJ,CAAeC,KAAf,GAAuB,CAAxB,EAA2BL,IAAII,UAAJ,CAAeE,MAAf,GAAwB,CAAnD;AAFC,SAAX,CADuB,CAA3B;;AAOA0B,8BAAsBC,MAAtB;AACH,KA3BD;AA4BH;;AAEDnB,M","file":"tilemap.bundle.js","sourcesContent":["import {TilemapTextureBuilder, TilemapRenderer, GridOutline, SpriteRenderer} from 'graphics.js';\nimport {Sprite} from 'components.js';\nimport {loadImage} from 'util.js';\nimport '../css/app.css'\n\nimport App from 'app.js';\n\n\nconst mountPoint = document.getElementById('content');\nconst canvas = document.createElement('canvas');\ncanvas.classList.add('game');\nmountPoint.appendChild(canvas);\n\n\nconst app = new App({\n    el: canvas,\n    debug: false,\n    clearColor: [0.1, 0.1, 0.1, 1],\n    resolution: {\n        width: 320,\n        height: 224\n    }\n});\n\n\napp.load({\n    basePath: 'shaders/',\n    programs: ['grid', 'tilemap', 'sprite']\n});\n\n\n// app.load({\n//     basePath: 'img/',\n//     textures: {\n//         sonic: {\n//             src: 'img/Sonic1.gif',\n//             mag: app.gl.NEAREST,\n//             min: app.gl.LINEAR,\n//             flipY: true\n//         }\n//     }\n// });\n\n\nconst tilemapTex = new TilemapTextureBuilder({\n    tileWidth: 16,\n    tileHeight: 16,\n    width: 16,\n    height: 16,\n    layers: 4\n});\n\nasync function run() {\n    await app.loader.loading;\n\n    tilemapTex.addTiles(await loadImage('img/mario.png'));\n\n    const framebufferRenderer = new SpriteRenderer({\n        game: app,\n        textureInfo: {\n            texture: app.framebuffer.texture,\n            ...app.resolution\n        }\n    });\n\n    const renderer = new TilemapRenderer({\n        game: app,\n        textureArray: tilemapTex.texture,\n        tilemap: {\n            tileWidth: 16,\n            tileHeight: 16,\n            width: 33,\n            height: 28,\n            getTile(x, y) {\n                const w = 33;\n                const h = 28;\n\n                x = x % w;\n                y = y % h;\n\n                return x + (h - y - 1) * w;\n            }\n        }\n    });\n\n    const grid = new GridOutline(app);\n    //grid.addGrid( 8,  8, [0.4, 0.1, 0.9, 0.4], 1);\n    //grid.addGrid(16, 16, [0.1, 0.3, 0.9, 0.4], 1);\n    //grid.addGrid(32, 32, [0,   0.5, 0.9, 0.3], 1);\n\n\n    requestAnimationFrame(function render() {\n        app.adjustViewport();\n        app.clear();\n\n        app.framebuffer.attach();\n        app.clear();\n\n        renderer.draw({\n            x: 0,\n            y: 224,\n            width: 320,\n            height: 224\n        });\n\n        grid.render();\n\n        app.framebuffer.detach();\n        app.adjustViewport();\n\n        framebufferRenderer.render([\n            new Sprite({\n                position: [0, 0],\n                size: [app.resolution.width - 1, app.resolution.height - 1]\n            })\n        ]);\n\n        requestAnimationFrame(render);\n    });\n}\n\nrun();\n\n\n\n// WEBPACK FOOTER //\n// ./src/demo/tilemap.js"],"sourceRoot":""}